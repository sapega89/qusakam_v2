# Триггер выхода из каньона (CanyonExitTrigger)

## Описание

`CanyonExitTrigger` - это триггер, который размещается на краю каньона, у выхода в пустыню. При входе игрока в зону триггера показывается катсцена спуска с каньона, затем происходит переход в пустыню через Metroidvania System.

## Использование

### 1. Добавление в сцену

1. Открыть крайнюю сцену каньона (у выхода в пустыню) в Godot Editor
2. Добавить `Area2D` → назвать `CanyonExitTrigger`
3. Присвоить скрипт: `SampleProject/Scripts/Gameplay/CanyonExitTrigger.gd`
4. Добавить `CollisionShape2D` с `RectangleShape2D` или `CircleShape2D`
5. Разместить у края каньона, перед выходом в пустыню

### 2. Настройка параметров

**target_room** (String):
- Комната для перехода после катсцены
- По умолчанию: `"DesertRoad.tscn"`
- Можно изменить на другой room_id, если нужно

**one_shot** (bool):
- Срабатывает только один раз (по умолчанию: `true`)
- Если `false`, триггер может сработать несколько раз

### 3. Размещение

Триггер должен быть размещен:
- В крайней сцене каньона (room_id содержит "relic", "end", "exit" или "final")
- У края каньона, перед выходом в пустыню
- После RelicArmor (обладунков), если они есть в сцене

## Как это работает

1. **Игрок входит в зону триггера:**
   - Проверяется, что это игрок (`GameGroups.PLAYER`)
   - Проверяется, что триггер еще не сработал (если `one_shot = true`)

2. **Активация катсцены:**
   - Вызывается `canyon_scene.trigger_exit_cutscene(target_room)`
   - Canyon.gd переходит в состояние `EXIT_CUTSCENE`

3. **Показ катсцены:**
   - Запускается диалог `Canyon_ExitCutscene.dqd`
   - Показывается сцена спуска Кусакама с каньона

4. **Переход в пустыню:**
   - После завершения катсцены состояние меняется на `TO_DESERT_ROAD`
   - Вызывается `Game.get_singleton().load_room(target_room)`
   - Игрок переходит в пустыню через MetSys

## Состояния Canyon.gd

- `RELIC_PICKUP` → игрок подобрал реликвию, может идти к выходу
- `EXIT_CUTSCENE` → показывается катсцена спуска с каньона
- `TO_DESERT_ROAD` → переход в пустыню через MetSys

## Пример структуры сцены

```
Canyon_End (Node2D)
├── RoomInstance (room_id: "canyon_end")
├── SavePoint_Relic
├── RelicArmor (обладунки)
├── CanyonExitTrigger (триггер выхода)
│   ├── CollisionShape2D
│   └── target_room: "DesertRoad.tscn"
└── [другие объекты]
```

## Проверка

После настройки проверить:
1. ✅ Игрок может дойти до триггера выхода
2. ✅ При входе в зону запускается катсцена спуска
3. ✅ После катсцены происходит переход в пустыню
4. ✅ Переход работает через MetSys корректно
